# SODC User Queries

# @auth() directives control who can call each operation.

# Get the current authenticated user's profile
query GetCurrentUser @auth(level: USER) {
  user(key: { id_expr: "auth.uid" }) {
    id
    firstName
    lastName
    email
    serviceNumber
    membershipStatus
    isRegular
    isReserve
    isCivilServant
    isIndustry
    createdAt
    updatedAt
  }
}

# Get a user by ID (admin only)
query GetUserById($id: String!) @auth(expr: "auth.token.admin == true") {
  user(id: $id) {
    id
    firstName
    lastName
    email
    serviceNumber
    membershipStatus
    isRegular
    isReserve
    isCivilServant
    isIndustry
    createdAt
    updatedAt
    createdBy
    updatedBy
  }
}

# List all users (admin only)
query ListUsers @auth(expr: "auth.token.admin == true") {
  users {
    id
    firstName
    lastName
    email
    serviceNumber
    membershipStatus
    isRegular
    isReserve
    isCivilServant
    isIndustry
    createdAt
    updatedAt
  }
}

# SODC Section and Access Group Queries

# Get all sections (admin only)
query ListSections @auth(expr: "auth.token.admin == true") {
  sections {
    id
    name
    type
    description
    createdAt
    updatedAt
  }
}

# Get sections accessible to the current user
query GetSectionsForUser @auth(level: USER) {
  user(key: { id_expr: "auth.uid" }) {
    id
    # Get access groups this user belongs to
    accessGroups: userAccessGroups_on_user {
      accessGroup {
        id
        name
        # Get sections this access group can access
        sections: sectionAccessGroups_on_accessGroup {
          section {
            id
            name
            type
            description
          }
        }
      }
    }
  }
}

# Get all access groups (admin only)
query ListAccessGroups @auth(expr: "auth.token.admin == true") {
  accessGroups {
    id
    name
    description
    createdAt
    updatedAt
  }
}

# Get access groups for the current user
query GetUserAccessGroups @auth(level: USER) {
  user(key: { id_expr: "auth.uid" }) {
    id
    accessGroups: userAccessGroups_on_user {
      accessGroup {
        id
        name
        description
      }
    }
  }
}
